<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¸å’Œ å…«å­—å‘½ç›¤æŸ¥è©¢</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding: 20px; line-height: 1.6; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 700px; }
        h1, h2, h3 { text-align: center; color: #2c3e50; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #34495e; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        button { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .result-box { margin-top: 30px; display: none; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* å‘½ç›¤è¡¨æ ¼æ¨£å¼ */
        .chart-table { width: 100%; border-collapse: separate; border-spacing: 4px; margin-bottom: 25px; text-align: center; table-layout: fixed; }
        .chart-table th { background: #ecf0f1; padding: 10px 5px; border-radius: 5px; color: #7f8c8d; font-size: 14px; }
        
        /* è¡¨æ ¼å–®å…ƒæ ¼åŸºç¤æ¨£å¼ */
        .chart-table td { background: #fff; border: 2px solid #ecf0f1; border-radius: 8px; padding: 10px 2px; vertical-align: top; }
        
        /* å¤©å¹²åœ°æ”¯å¤§å­— */
        .gan-zhi { font-size: 26px; font-weight: bold; display: block; margin: 5px 0; }
        
        /* å¤©å¹²åç¥ (é¡¯ç¤ºä¸€å€‹) */
        .god-label-top { font-size: 13px; color: #555; display: block; background: #fafafa; padding: 4px 0; border-radius: 4px; margin-bottom: 5px; font-weight: bold; }
        
        /* åœ°æ”¯è—å¹²é¡¯ç¤ºå€ */
        .hidden-stems-box { font-size: 12px; text-align: center; margin-top: 5px; color: #666; }
        .main-qi { color: #333; font-weight: bold; display: block; margin-bottom: 2px; font-size: 13px; } /* æœ¬æ°£æ¨£å¼ */
        .sub-qi { color: #999; display: block; font-size: 11px; transform: scale(0.9); } /* é¤˜æ°£æ¨£å¼ */

        /* é‡é»æ¨™ç¤º */
        .day-master-bg { border-color: #f1c40f !important; background-color: #fffcf0 !important; }

        /* äº”è¡Œé¡è‰² */
        .wood { color: #27ae60; } .fire { color: #c0392b; } .earth { color: #d35400; } .metal { color: #f39c12; } .water { color: #2980b9; }

        .analysis-card { background: #f8f9fa; padding: 20px; border-left: 5px solid #764ba2; border-radius: 5px; margin-bottom: 20px; }
        .analysis-card h4 { margin-top: 0; color: #764ba2; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ”® å…«å­—å‘½ç›¤ Pro+</h1>
    
    <div class="input-group">
        <label>å‡ºç”Ÿæ—¥æœŸ (åœ‹æ›†)</label>
        <input type="date" id="birthDate">
    </div>
    
    <div class="input-group">
        <label>å‡ºç”Ÿæ™‚é–“</label>
        <input type="time" id="birthTime" value="12:00">
    </div>

    <button onclick="calculateBazi()">æŸ¥çœ‹å‘½ç›¤</button>

    <div id="result" class="result-box">
        <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">
        <h2>ğŸ—“ï¸ æ‚¨çš„å…«å­—å‘½ç›¤</h2>
        
        <table class="chart-table">
            <thead>
                <tr>
                    <th>å¹´æŸ±</th>
                    <th>æœˆæŸ±</th>
                    <th>æ—¥æŸ± (å…ƒç¥)</th>
                    <th>æ™‚æŸ±</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span id="yearGod" class="god-label-top"></span></td>
                    <td><span id="monthGod" class="god-label-top"></span></td>
                    <td><span class="god-label-top" style="background:#f1c40f; color:white;">æ—¥ä¸»</span></td>
                    <td><span id="hourGod" class="god-label-top"></span></td>
                </tr>
                <tr>
                    <td id="yearGan"></td>
                    <td id="monthGan"></td>
                    <td id="dayGan" class="day-master-bg"></td>
                    <td id="hourGan"></td>
                </tr>
                <tr>
                    <td id="yearZhi"></td>
                    <td id="monthZhi"></td>
                    <td id="dayZhi" class="day-master-bg"></td>
                    <td id="hourZhi"></td>
                </tr>
                <tr>
                    <td id="yearHidden"></td>
                    <td id="monthHidden"></td>
                    <td id="dayHidden"></td>
                    <td id="hourHidden"></td>
                </tr>
            </tbody>
        </table>

        <div class="analysis-card">
            <h4>ğŸ‘¤ æœ¬å‘½æ€§æ ¼ (æ—¥ä¸»)</h4>
            <p><strong>æ‚¨çš„æ ¸å¿ƒæœ¬è³ªï¼š</strong> <span id="dayMasterDesc"></span></p>
            <p id="personalityText"></p>
        </div>

        <div class="analysis-card">
            <h4>ğŸ’¼ è¡Œäº‹é¢¨æ ¼ (æœˆä»¤æ ¼å±€)</h4>
            <p><strong>æ‚¨çš„æ ¼å±€å‚¾å‘ï¼š</strong> <span id="patternType"></span></p>
            <p id="patternDesc"></p>
        </div>
    </div>
</div>

<script>
    const getElementClass = (char) => {
        const mapping = {
            'ç”²': 'wood', 'ä¹™': 'wood', 'å¯…': 'wood', 'å¯': 'wood',
            'ä¸™': 'fire', 'ä¸': 'fire', 'å·³': 'fire', 'åˆ': 'fire',
            'æˆŠ': 'earth', 'å·±': 'earth', 'è¾°': 'earth', 'æˆŒ': 'earth', 'ä¸‘': 'earth', 'æœª': 'earth',
            'åºš': 'metal', 'è¾›': 'metal', 'ç”³': 'metal', 'é…‰': 'metal',
            'å£¬': 'water', 'ç™¸': 'water', 'äº¥': 'water', 'å­': 'water'
        };
        return mapping[char] || '';
    };

    const renderChar = (char) => `<span class="gan-zhi ${getElementClass(char)}">${char}</span>`;

    // æ ¼å¼åŒ–åœ°æ”¯è—å¹²å‡½æ•¸
    const renderHiddenStems = (stemsArray) => {
        if (!stemsArray || stemsArray.length === 0) return '';
        let html = '<div class="hidden-stems-box">';
        // ç¬¬ä¸€å€‹æ˜¯æœ¬æ°£
        html += `<span class="main-qi">${stemsArray[0]}</span>`;
        // å‰©ä¸‹çš„é¤˜æ°£
        if (stemsArray.length > 1) {
            for (let i = 1; i < stemsArray.length; i++) {
                html += `<span class="sub-qi">${stemsArray[i]}</span>`;
            }
        }
        html += '</div>';
        return html;
    };

    const personalities = {
        'ç”²': 'æ“æœ‰å¤§æ¨¹èˆ¬çš„ç‰¹è³ªï¼Œæ­£ç›´ã€ä»æ…ˆä¸”å‘ä¸Šç”Ÿé•·ã€‚æ‚¨ä¸å–œæ­¡è¢«å±ˆæœï¼Œæœ‰é ˜è¢–é¢¨ç¯„ï¼Œä½†æœ‰æ™‚è¼ƒç‚ºå›ºåŸ·ã€‚',
        'ä¹™': 'æ“æœ‰èŠ±è‰èˆ¬çš„éŸŒæ€§ï¼Œé©æ‡‰åŠ›å¼·ï¼Œèº«æ®µæŸ”è»Ÿã€‚æ‚¨å–„æ–¼äº¤éš›ï¼Œå¿ƒæ€ç´°è†©ï¼Œå…§åœ¨ç”Ÿå‘½åŠ›æ¥µå¼·ã€‚',
        'ä¸™': 'åƒå¤ªé™½ä¸€æ¨£ç†±æƒ…é–‹æœ—ï¼Œä¸æ‹˜å°ç¯€ã€‚æ‚¨æ¨‚æ–¼åŠ©äººï¼Œè—ä¸ä½è©±ï¼Œæƒ…ç·’ä¾†å¾—å¿«å»å¾—ä¹Ÿå¿«ã€‚',
        'ä¸': 'åƒç‡­ç«èˆ¬æº«æš–ï¼Œå¿ƒæ€ç¸å¯†ã€‚æ‚¨å¤–è¡¨æ²ˆç©©ï¼Œå…§å¿ƒå……æ»¿ç†±æƒ…ï¼Œæ´å¯ŸåŠ›å¼·ï¼Œé©åˆç²¾ç´°çš„å·¥ä½œã€‚',
        'æˆŠ': 'åƒé«˜å±±ä¸€æ¨£ç©©é‡åšå¯¦ï¼Œè¬›ä¿¡ç”¨ã€‚æ‚¨çµ¦äººå®‰å…¨æ„Ÿï¼Œåšäº‹æŒ‰éƒ¨å°±ç­ï¼Œä¸å–œæ­¡è®Šå‹•ã€‚',
        'å·±': 'åƒç”°åœ’ä¹‹åœŸï¼ŒåŒ…å®¹åŠ›å¼·ï¼Œå¤šæ‰å¤šè—ã€‚æ‚¨å…§æ–‚è¬¹æ…ï¼Œèƒ½å­•è‚²è¬ç‰©ï¼Œä½†æœ‰æ™‚æœƒå„ªæŸ”å¯¡æ–·ã€‚',
        'åºš': 'åƒåˆ€åŠä¸€æ¨£å‰›æ¯…æœæ–·ï¼Œè¬›ç¾©æ°£ã€‚æ‚¨æ˜¯éåˆ†æ˜ï¼ŒåŸ·è¡ŒåŠ›å¼·ï¼Œä½†ç›´ç‡çš„å€‹æ€§å®¹æ˜“ç„¡æ„é–“å¾—ç½ªäººã€‚',
        'è¾›': 'åƒç å¯¶ä¸€æ¨£ç²¾ç·»ï¼Œé‡è¦–é¢å­èˆ‡è³ªæ„Ÿã€‚æ‚¨æ„Ÿå—åŠ›æ•éŠ³ï¼Œå£æ‰ä½³ï¼Œä½†å…§å¿ƒè¼ƒè„†å¼±ã€‚',
        'å£¬': 'åƒå¤§æµ·ä¸€æ¨£å¥”æ”¾ï¼Œè°æ˜ä¸”åæ‡‰å¿«ã€‚æ‚¨ä¸å–œæ­¡å—æ‹˜æŸï¼Œé©æ‡‰åŠ›æ¥µå¼·ï¼Œäººè„ˆå»£é—Šã€‚',
        'ç™¸': 'åƒé›¨éœ²ä¸€æ¨£æº«æŸ”ï¼Œå…§å‘ä¸”å¯Œæƒ³åƒåŠ›ã€‚æ‚¨å¿ƒæ€ç´°è†©ï¼Œç›´è¦ºæ•éŠ³ï¼Œå–„æ–¼è§€å¯Ÿäººå¿ƒã€‚'
    };

    const godPatterns = {
        'æ¯”è‚©': 'å»ºç¥¿æ ¼/æ¯”è‚©å¼·ï¼šè‡ªå°Šå¿ƒå¼·ï¼Œç¨ç«‹è‡ªä¸»ï¼Œæ¯”èµ·å—åƒ±æ–¼äººï¼Œæ›´æ¸´æœ›æ“æœ‰è‡ªå·±çš„äº‹æ¥­ã€‚',
        'åŠ«è²¡': 'ç¾Šåˆƒ/åŠ«è²¡å¼·ï¼šé‡å¿ƒå‹ƒå‹ƒï¼Œç«¶çˆ­å¿ƒå¼·ï¼Œå…·æœ‰å¾ˆå¼·çš„åŸ·è¡ŒåŠ›èˆ‡ç¤¾äº¤æ‰‹è…•ï¼Œä½†éœ€æ³¨æ„ç†è²¡ã€‚',
        'é£Ÿç¥': 'é£Ÿç¥æ ¼ï¼šæ€§æƒ…æº«å’Œï¼Œé‡è¦–ç”Ÿæ´»å“è³ªèˆ‡äº«å—ï¼Œé€šå¸¸å¾ˆæœ‰å£ç¦ï¼Œé©åˆå‰µæ„é ˜åŸŸã€‚',
        'å‚·å®˜': 'å‚·å®˜æ ¼ï¼šæ‰æ€æ•æ·ï¼Œå›é€†å¿ƒå¼·ï¼Œè¨å­å‚³çµ±æŸç¸›ï¼Œè¡¨é”èƒ½åŠ›æ¥µä½³ã€‚',
        'æ­£è²¡': 'æ­£è²¡æ ¼ï¼šå€‹æ€§å‹™å¯¦ï¼Œé‡è¦–å‹¤å‹è‡´å¯Œï¼Œåšäº‹è¬¹æ…å°å¿ƒï¼Œæ˜¯æ¨™æº–çš„ç†è²¡å¥½æ‰‹ã€‚',
        'åè²¡': 'åè²¡æ ¼ï¼šæ…·æ…¨è±ªçˆ½ï¼Œé‡‘éŒ¢è§€å¿µéˆæ´»ï¼Œçœ¼å…‰ç¨åˆ°ï¼Œé©åˆæŠ•è³‡æˆ–ç¶“å•†ã€‚',
        'æ­£å®˜': 'æ­£å®˜æ ¼ï¼šç‚ºäººæ­£ç›´ï¼Œé‡è¦–ç´€å¾‹èˆ‡åè­½ï¼Œæœ‰è²¬ä»»æ„Ÿï¼Œé©åˆç®¡ç†è·æˆ–å…¬è·ã€‚',
        'ä¸ƒæ®º': 'ä¸ƒæ®ºæ ¼ï¼šå…·æœ‰æ¬Šå¨æ„Ÿï¼Œè¡Œäº‹æœæ±ºï¼Œä¸ç•è‰±é›£ï¼Œå–œæ­¡æŒ‘æˆ°é«˜é›£åº¦çš„ä»»å‹™ã€‚',
        'æ­£å°': 'æ­£å°æ ¼ï¼šå¿ƒåœ°å–„è‰¯ï¼Œé‡è¦–ç²¾ç¥å±¤é¢ï¼Œå–œæ­¡å­¸ç¿’èˆ‡æ€è€ƒï¼Œå€‹æ€§è¼ƒç‚ºä¿å®ˆã€‚',
        'åå°': 'åå°æ ¼ï¼šæ€è€ƒç¨ç‰¹ï¼Œç›´è¦ºæ•éŠ³ï¼Œä¸å–œæ­¡éš¨æ³¢é€æµï¼Œåœ¨ç‰¹æ®Šé ˜åŸŸæœ‰éäººé ˜æ‚ŸåŠ›ã€‚'
    };

    function calculateBazi() {
        const dateInput = document.getElementById('birthDate').value;
        const timeInput = document.getElementById('birthTime').value;

        if (!dateInput || !timeInput) {
            alert('è«‹è¼¸å…¥å®Œæ•´çš„å‡ºç”Ÿæ—¥æœŸèˆ‡æ™‚é–“');
            return;
        }

        const [year, month, day] = dateInput.split('-').map(Number);
        const [hour, minute] = timeInput.split(':').map(Number);

        const solar = Solar.fromYmdHms(year, month, day, hour, minute, 0);
        const lunar = solar.getLunar();
        const baZi = lunar.getEightChar();

        document.getElementById('result').style.display = 'block';
        
        // å¤©å¹²åœ°æ”¯
        document.getElementById('yearGan').innerHTML = renderChar(baZi.getYearGan());
        document.getElementById('yearZhi').innerHTML = renderChar(baZi.getYearZhi());
        document.getElementById('monthGan').innerHTML = renderChar(baZi.getMonthGan());
        document.getElementById('monthZhi').innerHTML = renderChar(baZi.getMonthZhi());
        document.getElementById('dayGan').innerHTML = renderChar(baZi.getDayGan());
        document.getElementById('dayZhi').innerHTML = renderChar(baZi.getDayZhi());
        document.getElementById('hourGan').innerHTML = renderChar(baZi.getTimeGan());
        document.getElementById('hourZhi').innerHTML = renderChar(baZi.getTimeZhi());

        // å¤©å¹²åç¥
        document.getElementById('yearGod').innerText = baZi.getYearShiShenGan();
        document.getElementById('monthGod').innerText = baZi.getMonthShiShenGan();
        document.getElementById('hourGod').innerText = baZi.getTimeShiShenGan();

        // åœ°æ”¯è—å¹² (æ–°åŠŸèƒ½ï¼šé¡¯ç¤ºå…¨éƒ¨)
        document.getElementById('yearHidden').innerHTML = renderHiddenStems(baZi.getYearShiShenZhi());
        document.getElementById('monthHidden').innerHTML = renderHiddenStems(baZi.getMonthShiShenZhi());
        document.getElementById('dayHidden').innerHTML = renderHiddenStems(baZi.getDayShiShenZhi());
        document.getElementById('hourHidden').innerHTML = renderHiddenStems(baZi.getTimeShiShenZhi());

        // è§£æ
        const dayGan = baZi.getDayGan();
        document.getElementById('dayMasterDesc').innerText = `${dayGan} (${getElementClass(dayGan) === 'wood' ? 'æœ¨' : getElementClass(dayGan) === 'fire' ? 'ç«' : getElementClass(dayGan) === 'earth' ? 'åœŸ' : getElementClass(dayGan) === 'metal' ? 'é‡‘' : 'æ°´'})`;
        document.getElementById('personalityText').innerText = personalities[dayGan];

        const patternGod = baZi.getMonthShiShenZhi()[0]; 
        document.getElementById('patternType').innerText = patternGod;
        document.getElementById('patternDesc').innerText = godPatterns[patternGod] || 'æ ¼å±€è¼ƒç‚ºè¤‡é›œï¼Œèåˆäº†å¤šç¨®ç‰¹è³ªã€‚';
    }
</script>

</body>
</html>