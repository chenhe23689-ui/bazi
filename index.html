<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­å…«å­—å‘½ç›¤ V2.0 | äº”è¡Œé›·é”èˆ‡æµæ™‚é‹å‹¢</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: "Microsoft JhengHei", "PingFang TC", Arial, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding: 20px; line-height: 1.6; padding-bottom: 80px; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 800px; position: relative; }
        
        h1 { text-align: center; color: #2c3e50; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #7f8c8d; font-size: 14px; margin-bottom: 25px; }

        .form-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .input-group { flex: 1; min-width: 150px; }
        
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #34495e; font-size: 14px; }
        input[type="date"], input[type="time"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        /* æ€§åˆ¥é¸æ“‡ */
        .gender-group { display: flex; gap: 20px; align-items: center; height: 42px; }
        .radio-label { display: flex; align-items: center; gap: 5px; cursor: pointer; }

        /* æŸ¥è©¢æŒ‰éˆ• */
        .btn-calc { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; box-shadow: 0 4px 10px rgba(118, 75, 162, 0.3); }
        .btn-calc:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .result-box { margin-top: 30px; display: none; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* å…«å­—è¡¨æ ¼ */
        .chart-table { width: 100%; border-collapse: separate; border-spacing: 4px; margin-bottom: 25px; text-align: center; table-layout: fixed; }
        .chart-table th { background: #ecf0f1; padding: 8px 2px; border-radius: 5px; color: #7f8c8d; font-size: 13px; }
        .chart-table td { background: #fff; border: 2px solid #ecf0f1; border-radius: 8px; padding: 10px 2px; vertical-align: top; }
        
        .gan-zhi { font-size: 24px; font-weight: bold; display: block; margin: 5px 0; }
        .god-label-top { font-size: 12px; color: #555; display: block; background: #fafafa; padding: 4px 0; border-radius: 4px; margin-bottom: 5px; font-weight: bold; }
        .hidden-stems-box { font-size: 12px; text-align: center; margin-top: 5px; color: #666; }
        .main-qi { color: #333; font-weight: bold; display: block; margin-bottom: 2px; font-size: 13px; }
        .sub-qi { color: #999; display: block; font-size: 11px; transform: scale(0.9); }
        .day-master-bg { border-color: #f1c40f !important; background-color: #fffcf0 !important; }

        /* äº”è¡Œé¡è‰² */
        .wood { color: #27ae60; } .fire { color: #c0392b; } .earth { color: #d35400; } .metal { color: #f39c12; } .water { color: #2980b9; }

        /* åˆ†æå¡ç‰‡æ¨£å¼ */
        .cards-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 600px) { .cards-container { grid-template-columns: 1fr; } }
        
        .analysis-card { background: #f8f9fa; padding: 20px; border-left: 5px solid #764ba2; border-radius: 5px; margin-bottom: 20px; height: 100%; box-sizing: border-box; }
        .analysis-card h4 { margin-top: 0; color: #764ba2; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .card-content { font-size: 15px; color: #444; }
        
        /* é›·é”åœ–å€å¡Š */
        .chart-container { position: relative; height: 300px; width: 100%; margin: 20px auto; }

        /* å»ºè­°æ¨™ç±¤ */
        .tag { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 12px; color: white; margin-right: 5px; margin-bottom: 5px;}
        .tag-good { background: #2ecc71; }
        .tag-bad { background: #e74c3c; }

        /* å³æ™‚é‹å‹¢å€å¡Š */
        .luck-box { background: linear-gradient(to right, #2c3e50, #4ca1af); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .luck-header { font-size: 18px; font-weight: bold; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .luck-time { font-size: 12px; opacity: 0.8; }
        .luck-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; text-align: center; margin-top: 10px; }
        .luck-item { background: rgba(255,255,255,0.1); padding: 8px; border-radius: 5px; }
        .luck-label { font-size: 12px; display: block; margin-bottom: 2px; opacity: 0.8; }
        .luck-val { font-size: 18px; font-weight: bold; }
        .luck-advice { margin-top: 15px; font-size: 14px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px; }

        .footer { text-align: center; margin-top: 30px; font-size: 12px; color: #aaa; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ§¬ å…«å­—å‘½ç† AI è§£æç³»çµ±</h1>
    <div class="subtitle">æ·±åº¦è§£ææ ¼å±€ã€èº«å¼·å¼±ã€å¥åº·èˆ‡å³æ™‚æµé‹</div>
    
    <div class="form-row">
        <div class="input-group">
            <label>å‡ºç”Ÿæ—¥æœŸ (åœ‹æ›†)</label>
            <input type="date" id="birthDate">
        </div>
        <div class="input-group">
            <label>å‡ºç”Ÿæ™‚é–“</label>
            <input type="time" id="birthTime" value="12:00">
        </div>
    </div>
    <div class="form-row">
        <div class="input-group">
            <label>æ€§åˆ¥</label>
            <div class="gender-group">
                <label class="radio-label"><input type="radio" name="gender" value="1" checked> ç”·</label>
                <label class="radio-label"><input type="radio" name="gender" value="0"> å¥³</label>
            </div>
        </div>
    </div>

    <button class="btn-calc" onclick="calculateBazi()">é–‹å§‹æ·±åº¦é‹ç®—</button>

    <div id="result" class="result-box">
        
        <div class="luck-box">
            <div class="luck-header">
                <span><i class="fas fa-clock"></i> æ­¤åˆ»é‹å‹¢ (æµæ™‚)</span>
                <span class="luck-time" id="currentTimeStr">æ›´æ–°æ–¼: --:--</span>
            </div>
            <div class="luck-grid">
                <div class="luck-item">
                    <span class="luck-label">æµå¹´</span>
                    <span class="luck-val" id="curYear"></span>
                </div>
                <div class="luck-item">
                    <span class="luck-label">æµæœˆ</span>
                    <span class="luck-val" id="curMonth"></span>
                </div>
                <div class="luck-item">
                    <span class="luck-label">æµæ—¥</span>
                    <span class="luck-val" id="curDay"></span>
                </div>
                <div class="luck-item">
                    <span class="luck-label">æµæ™‚</span>
                    <span class="luck-val" id="curHour"></span>
                </div>
            </div>
            <div class="luck-advice" id="currentLuckAdvice">
                æ­£åœ¨é€£ç·šè¨ˆç®—ç•¶ä¸‹ç£å ´èƒ½é‡...
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">
        
        <h2 style="text-align:center;">ğŸ—“ï¸ æ‚¨çš„æœ¬å‘½å…«å­—</h2>
        
        <table class="chart-table">
            <thead>
                <tr>
                    <th>å¹´æŸ± (ç¥–ä¸Š)</th>
                    <th>æœˆæŸ± (çˆ¶æ¯/äº‹æ¥­)</th>
                    <th>æ—¥æŸ± (æœ¬å‘½/é…å¶)</th>
                    <th>æ™‚æŸ± (å­å¥³/æ™šå¹´)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span id="yearGod" class="god-label-top"></span></td>
                    <td><span id="monthGod" class="god-label-top"></span></td>
                    <td><span class="god-label-top" style="background:#f1c40f; color:white;">å…ƒç¥</span></td>
                    <td><span id="hourGod" class="god-label-top"></span></td>
                </tr>
                <tr>
                    <td id="yearGan"></td>
                    <td id="monthGan"></td>
                    <td id="dayGan" class="day-master-bg"></td>
                    <td id="hourGan"></td>
                </tr>
                <tr>
                    <td id="yearZhi"></td>
                    <td id="monthZhi"></td>
                    <td id="dayZhi" class="day-master-bg"></td>
                    <td id="hourZhi"></td>
                </tr>
                <tr>
                    <td id="yearHidden"></td>
                    <td id="monthHidden"></td>
                    <td id="dayHidden"></td>
                    <td id="hourHidden"></td>
                </tr>
            </tbody>
        </table>

        <div class="analysis-card" style="border-left-color: #3498db;">
            <h4>ğŸ“Š äº”è¡Œèƒ½é‡å¹³è¡¡åœ–</h4>
            <div class="chart-container">
                <canvas id="wuxingChart"></canvas>
            </div>
            <p id="wuxingComment" style="font-size: 14px; text-align: center; color: #666;"></p>
        </div>

        <div class="cards-container">
            <div class="analysis-card">
                <h4>âš–ï¸ æ ¼å±€èˆ‡ç”¨ç¥å»ºè­°</h4>
                <div class="card-content">
                    <p><strong>æ—¥ä¸»å¼·å¼±ï¼š</strong> <span id="bodyStrength" style="font-weight:bold; color:#d35400;"></span></p>
                    <p><strong>æ ¼å±€åˆ¤æ–·ï¼š</strong> <span id="patternType"></span></p>
                    <hr style="border:0; border-top:1px dashed #ddd; margin:10px 0;">
                    <p><strong>ğŸ’¡ æ”¹é‹å»ºè­° (å–œç”¨ç¥)ï¼š</strong></p>
                    <div id="luckyAdvice"></div>
                </div>
            </div>

            <div class="analysis-card" style="border-left-color: #e74c3c;">
                <h4>ğŸ¥ äº”è¡Œç—…ç¶æƒæ</h4>
                <div class="card-content">
                    <p style="font-size:13px; color:#999; margin-bottom:10px;">*åƒ…ä¾›å‘½ç†åƒè€ƒï¼Œèº«é«”ä¸é©è«‹å‹™å¿…å°±é†«</p>
                    <div id="healthRisks"></div>
                </div>
            </div>
        </div>

        <div class="analysis-card">
            <h4>ğŸ‘¤ æœ¬å‘½æ€§æ ¼æ·±åº¦è§£æ</h4>
            <p><strong>æ‚¨çš„æ ¸å¿ƒæœ¬è³ªï¼š</strong> <span id="dayMasterDesc"></span></p>
            <p id="personalityText" class="card-content"></p>
        </div>

    </div>
    
    <div class="footer">
        &copy; 2024 å°ˆæ¥­å…«å­—å‘½ç†ç³»çµ± | V2.0 å¢å¼·ç‰ˆ
    </div>
</div>

<script>
    // === 1. åŸºç¤å·¥å…·å‡½æ•¸ ===
    function toTraditional(str) {
        if (!str) return '';
        return str.toString()
            .replace(/è´¢/g, 'è²¡').replace(/ä¼¤/g, 'å‚·').replace(/æ€/g, 'æ®º')
            .replace(/æ­/g, 'æ¢Ÿ').replace(/ä¸‘/g, 'ä¸‘').replace(/è¿/g, 'é‹')
            .replace(/å†²/g, 'æ²–').replace(/å…‹/g, 'å‰‹');
    }

    const getElementClass = (char) => {
        const mapping = {
            'ç”²': 'wood', 'ä¹™': 'wood', 'å¯…': 'wood', 'å¯': 'wood',
            'ä¸™': 'fire', 'ä¸': 'fire', 'å·³': 'fire', 'åˆ': 'fire',
            'æˆŠ': 'earth', 'å·±': 'earth', 'è¾°': 'earth', 'æˆŒ': 'earth', 'ä¸‘': 'earth', 'æœª': 'earth',
            'åºš': 'metal', 'è¾›': 'metal', 'ç”³': 'metal', 'é…‰': 'metal',
            'å£¬': 'water', 'ç™¸': 'water', 'äº¥': 'water', 'å­': 'water'
        };
        return mapping[char] || '';
    };

    const getElementFromChar = (char) => {
        const map = {'wood':'æœ¨', 'fire':'ç«', 'earth':'åœŸ', 'metal':'é‡‘', 'water':'æ°´'};
        return map[getElementClass(char)];
    };

    const renderChar = (char) => {
        const tradChar = toTraditional(char);
        return `<span class="gan-zhi ${getElementClass(tradChar)}">${tradChar}</span>`;
    };

    const renderHiddenStems = (stemsArray) => {
        if (!stemsArray || stemsArray.length === 0) return '';
        let html = '<div class="hidden-stems-box">';
        html += `<span class="main-qi">${toTraditional(stemsArray[0])}</span>`;
        if (stemsArray.length > 1) {
            for (let i = 1; i < stemsArray.length; i++) {
                html += `<span class="sub-qi">${toTraditional(stemsArray[i])}</span>`;
            }
        }
        html += '</div>';
        return html;
    };

    // Chart.js å¯¦ä¾‹
    let radarChart = null;

    // === 2. æ ¸å¿ƒé‹ç®—ä¸»ç¨‹å¼ ===
    function calculateBazi() {
        const dateInput = document.getElementById('birthDate').value;
        const timeInput = document.getElementById('birthTime').value;
        // å–å¾—æ€§åˆ¥ï¼š1ç”· 0å¥³ (é›–ç„¶lunaråº« 1=ç”· 0=å¥³ï¼Œä½†é€™è£¡ä¸»è¦ç”¨æ–¼è¨˜éŒ„æˆ–å¤§é‹è¨ˆç®—)
        const gender = document.querySelector('input[name="gender"]:checked').value;

        if (!dateInput || !timeInput) {
            alert('è«‹è¼¸å…¥å®Œæ•´çš„å‡ºç”Ÿæ—¥æœŸèˆ‡æ™‚é–“');
            return;
        }

        const [year, month, day] = dateInput.split('-').map(Number);
        const [hour, minute] = timeInput.split(':').map(Number);

        // åˆå§‹åŒ–å…«å­—ç‰©ä»¶
        const solar = Solar.fromYmdHms(year, month, day, hour, minute, 0);
        const lunar = solar.getLunar();
        const baZi = lunar.getEightChar();
        
        // è¨­å®šæ€§åˆ¥ (å½±éŸ¿å¤§é‹ï¼Œé›–ç„¶æ­¤ç¯„ä¾‹æš«æœªå±•é–‹å¤§é‹åˆ—è¡¨ï¼Œä½†é‚è¼¯è¦å°)
        // Lunaråº«é è¨­å¯èƒ½ä¸éœ€æ‰‹å‹•è¨­æ€§åˆ¥çµ¦EightCharï¼Œä½†åœ¨è¨ˆç®—å¤§é‹æ™‚éœ€è¦

        // é¡¯ç¤ºçµæœå€å¡Š
        document.getElementById('result').style.display = 'block';

        // A. æ¸²æŸ“å…«å­—ç›¤ (åŒå‰ç‰ˆ)
        document.getElementById('yearGan').innerHTML = renderChar(baZi.getYearGan());
        document.getElementById('yearZhi').innerHTML = renderChar(baZi.getYearZhi());
        document.getElementById('monthGan').innerHTML = renderChar(baZi.getMonthGan());
        document.getElementById('monthZhi').innerHTML = renderChar(baZi.getMonthZhi());
        document.getElementById('dayGan').innerHTML = renderChar(baZi.getDayGan());
        document.getElementById('dayZhi').innerHTML = renderChar(baZi.getDayZhi());
        document.getElementById('hourGan').innerHTML = renderChar(baZi.getTimeGan());
        document.getElementById('hourZhi').innerHTML = renderChar(baZi.getTimeZhi());

        document.getElementById('yearGod').innerText = toTraditional(baZi.getYearShiShenGan());
        document.getElementById('monthGod').innerText = toTraditional(baZi.getMonthShiShenGan());
        document.getElementById('hourGod').innerText = toTraditional(baZi.getTimeShiShenGan());

        document.getElementById('yearHidden').innerHTML = renderHiddenStems(baZi.getYearShiShenZhi());
        document.getElementById('monthHidden').innerHTML = renderHiddenStems(baZi.getMonthShiShenZhi());
        document.getElementById('dayHidden').innerHTML = renderHiddenStems(baZi.getDayShiShenZhi());
        document.getElementById('hourHidden').innerHTML = renderHiddenStems(baZi.getTimeShiShenZhi());

        // B. åŸºç¤è§£æ (æ€§æ ¼èˆ‡æ ¼å±€)
        analyzeBasic(baZi);

        // C. äº”è¡Œèƒ½é‡è¨ˆç®—èˆ‡é›·é”åœ–
        const scores = calculateFiveElementsScore(baZi);
        renderRadarChart(scores);

        // D. èº«å¼·èº«å¼±èˆ‡ç”¨ç¥å»ºè­°
        analyzeStrengthAndAdvice(baZi, scores);

        // E. å¥åº·æƒæ
        analyzeHealth(scores);

        // F. å³æ™‚æµå¹´æµæœˆæµæ—¥é‹å‹¢
        analyzeCurrentLuck(baZi);

        // æ²å‹•åˆ°çµæœ
        setTimeout(() => {
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }, 100);
    }

    // === 3. åˆ†æé‚è¼¯æ¨¡çµ„ ===

    function analyzeBasic(baZi) {
        const dayGan = baZi.getDayGan();
        const personalities = {
            'ç”²': 'ç”²æœ¨å¦‚åƒå¤©å¤§æ¨¹ï¼Œæ­£ç›´ä»æ…ˆï¼Œä¸å±ˆä¸æ’“ã€‚æ‚¨æœ‰é ˜è¢–æ°£è³ªï¼Œä½†æœ‰æ™‚éæ–¼å›ºåŸ·ï¼Œä¸é¡˜è®Šé€šã€‚',
            'ä¹™': 'ä¹™æœ¨å¦‚èŠ±è‰è—¤è”“ï¼Œèº«æ®µæŸ”è»Ÿï¼Œé©æ‡‰åŠ›å¼·ã€‚æ‚¨å–„æ–¼äº¤éš›ï¼Œå¿ƒæ€ç´°è†©ï¼Œä½†å®¹æ˜“ä¾è³´ä»–äººã€‚',
            'ä¸™': 'ä¸™ç«å¦‚å¤ªé™½ï¼Œç†±æƒ…é–‹æœ—ï¼Œä¸æ‹˜å°ç¯€ã€‚æ‚¨æ¨‚æ–¼åŠ©äººï¼Œæƒ…ç·’ä¾†å»å¾—å¿«ï¼Œä½†æœ‰æ™‚å®¹æ˜“è¡å‹•ã€‚',
            'ä¸': 'ä¸ç«å¦‚ç‡­å…‰ï¼Œæº«æš–è²¼å¿ƒï¼Œæ´å¯ŸåŠ›å¼·ã€‚æ‚¨å¤–è¡¨æ²ˆç©©å…§å¿ƒç†±æƒ…ï¼Œæœ‰çŠ§ç‰²å¥‰ç»çš„ç²¾ç¥ã€‚',
            'æˆŠ': 'æˆŠåœŸå¦‚é«˜å±±ï¼Œç©©é‡åšå¯¦ï¼Œè¬›æ±‚ä¿¡ç”¨ã€‚æ‚¨åŒ…å®¹åŠ›å¼·ï¼Œå–œæ­¡ç©©å®šï¼Œä½†åæ‡‰æœ‰æ™‚è¼ƒæ…¢ã€‚',
            'å·±': 'å·±åœŸå¦‚ç”°åœ’ï¼Œå…§æ–‚è¬¹æ…ï¼Œå¤šæ‰å¤šè—ã€‚æ‚¨åšäº‹ç´°å¿ƒï¼Œä½†å®¹æ˜“å„ªæŸ”å¯¡æ–·ï¼Œæƒ³å¾—å¤ªå¤šã€‚',
            'åºš': 'åºšé‡‘å¦‚åˆ€åŠï¼Œå‰›æ¯…æœæ–·ï¼Œè¬›ç¾©æ°£ã€‚æ‚¨åŸ·è¡ŒåŠ›å¼·ï¼Œæ„›æ†åˆ†æ˜ï¼Œä½†æœ‰æ™‚éæ–¼å¼·å‹¢å‚·äººã€‚',
            'è¾›': 'è¾›é‡‘å¦‚ç å¯¶ï¼Œç²¾ç·»å„ªé›…ï¼Œé‡è¦–è³ªæ„Ÿã€‚æ‚¨å£æ‰ä½³ï¼Œæ„Ÿå—åŠ›æ•éŠ³ï¼Œä½†è‡ªå°Šå¿ƒå¼·ï¼Œå—ä¸äº†æ‰¹è©•ã€‚',
            'å£¬': 'å£¬æ°´å¦‚æ±Ÿæ²³ï¼Œå¥”æ”¾è‡ªç”±ï¼Œè°æ˜æ©Ÿæ™ºã€‚æ‚¨åæ‡‰å¿«ï¼Œäººè„ˆå»£ï¼Œä½†æœ‰æ™‚æµå‹•æ€§å¤ªå¼·ç¼ºä¹å®šæ€§ã€‚',
            'ç™¸': 'ç™¸æ°´å¦‚é›¨éœ²ï¼Œæº«æŸ”å…§å‘ï¼Œæƒ³åƒåŠ›å¯Œã€‚æ‚¨å¿ƒæ€ç´°å¯†ï¼Œå–„æ–¼è§€å¯Ÿï¼Œä½†æƒ…ç·’å®¹æ˜“å—ç’°å¢ƒå½±éŸ¿ã€‚'
        };
        
        document.getElementById('dayMasterDesc').innerText = `${toTraditional(dayGan)}æ—¥ä¸» (${getElementFromChar(dayGan)})`;
        document.getElementById('personalityText').innerText = personalities[dayGan] || '';

        // æ ¼å±€ (ç°¡åŒ–ç‰ˆï¼šå–æœˆæ”¯ä¸»æ°£)
        const patternGod = toTraditional(baZi.getMonthShiShenZhi()[0]);
        document.getElementById('patternType').innerText = patternGod + "æ ¼ (æœˆä»¤ä¸»æ°£)";
    }

    // è¨ˆç®—äº”è¡Œåˆ†æ•¸ (åŠ æ¬Šæ¼”ç®—æ³•)
    function calculateFiveElementsScore(baZi) {
        // åˆå§‹åˆ†æ•¸
        let scores = { 'é‡‘': 0, 'æœ¨': 0, 'æ°´': 0, 'ç«': 0, 'åœŸ': 0 };
        
        // æ¬Šé‡å®šç¾©ï¼šæœˆæ”¯æœ€å¼·(x2.5)ï¼Œæ—¥æ”¯æ¬¡ä¹‹(x1.5)ï¼Œå…¶ä»–(x1)
        const addScore = (char, weight) => {
            const el = getElementFromChar(char); // è½‰ç‚º é‡‘æœ¨æ°´ç«åœŸ
            if(el) scores[el] += (10 * weight);
        };

        // å¤©å¹² (æ¬Šé‡ 1.0)
        addScore(baZi.getYearGan(), 1.0);
        addScore(baZi.getMonthGan(), 1.0);
        addScore(baZi.getDayGan(), 1.0);
        addScore(baZi.getTimeGan(), 1.0);

        // åœ°æ”¯ (è—å¹²è™•ç†è¼ƒè¤‡é›œï¼Œé€™è£¡ç°¡åŒ–ç‚ºå–åœ°æ”¯æœ¬æ°£ï¼Œæœˆä»¤åŠ æ¬Š 2.5)
        addScore(baZi.getYearZhi(), 1.0);
        addScore(baZi.getMonthZhi(), 2.5); // æœˆä»¤æœ€é‡
        addScore(baZi.getDayZhi(), 1.5);   // æ—¥æ”¯åä¸‹
        addScore(baZi.getTimeZhi(), 1.0);

        return scores;
    }

    // ç¹ªè£½é›·é”åœ–
    function renderRadarChart(scores) {
        const ctx = document.getElementById('wuxingChart').getContext('2d');
        const dataValues = [scores['æœ¨'], scores['ç«'], scores['åœŸ'], scores['é‡‘'], scores['æ°´']];
        
        // åˆ¤æ–·äº”è¡Œå¼·å¼±æ–‡å­—
        let maxVal = 0; let maxEl = '';
        let minVal = 999; let minEl = '';
        const els = ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'];
        dataValues.forEach((v, i) => {
            if(v > maxVal) { maxVal = v; maxEl = els[i]; }
            if(v < minVal) { minVal = v; minEl = els[i]; }
        });
        document.getElementById('wuxingComment').innerHTML = 
            `<strong>${maxEl}</strong> æ°£æœ€æ—ºï¼Œ<strong>${minEl}</strong> æ°£è¼ƒå¼±ã€‚`;

        if (radarChart) radarChart.destroy();

        radarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['æœ¨ (è‚/ä»)', 'ç« (å¿ƒ/ç¦®)', 'åœŸ (è„¾/ä¿¡)', 'é‡‘ (è‚º/ç¾©)', 'æ°´ (è…/æ™º)'],
                datasets: [{
                    label: 'äº”è¡Œèƒ½é‡æŒ‡æ•¸',
                    data: dataValues,
                    backgroundColor: 'rgba(118, 75, 162, 0.2)',
                    borderColor: '#764ba2',
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#764ba2',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#764ba2'
                }]
            },
            options: {
                scales: { r: { beginAtZero: true, suggestMax: 40 } },
                plugins: { legend: { display: false } }
            }
        });
    }

    // èº«å¼·èº«å¼±èˆ‡ç”¨ç¥å»ºè­°
    function analyzeStrengthAndAdvice(baZi, scores) {
        const me = getElementFromChar(baZi.getDayGan()); // æ—¥ä¸»äº”è¡Œ
        
        // å®šç¾©ç”ŸåŠ©æˆ‘è€… (åŒé»¨)
        const supportMap = {
            'æœ¨': ['æœ¨', 'æ°´'], 'ç«': ['ç«', 'æœ¨'], 'åœŸ': ['åœŸ', 'ç«'], 
            'é‡‘': ['é‡‘', 'åœŸ'], 'æ°´': ['æ°´', 'é‡‘']
        };
        const sameParty = supportMap[me]; // ä¾‹å¦‚æœ¨æ—¥ä¸»ï¼ŒåŒé»¨ç‚º æœ¨ã€æ°´
        
        let sameScore = 0;
        let otherScore = 0;

        for (let el in scores) {
            if (sameParty.includes(el)) sameScore += scores[el];
            else otherScore += scores[el];
        }

        const isStrong = sameScore > otherScore;
        const strengthText = isStrong ? 'èº«å¼· (èƒ½é‡å……æ²›)' : 'èº«å¼± (éœ€è¦å¹«æ‰¶)';
        document.getElementById('bodyStrength').innerText = strengthText;

        // ç”Ÿæˆå»ºè­°
        let adviceHtml = '';
        if (isStrong) {
            // èº«å¼·å–œ å‰‹ã€æ´©ã€è€— (ç•°é»¨)
            adviceHtml += `<span class="tag tag-bad">å¿Œï¼š${sameParty.join('ã€')}</span> (å¤šå‰‡ç‚ºæ‚£)<br>`;
            adviceHtml += `æ‚¨èƒ½é‡å¼·ï¼Œå€‹æ€§è¼ƒä¸»è§€ã€‚<strong>å–œç”¨ç¥ç‚ºã€Œå‰‹æ´©ã€</strong>ä¹‹äº”è¡Œã€‚<br>`;
            adviceHtml += `å»ºè­°å¤šç©¿è‘—èˆ‡é${me}ç³»é¡è‰²çš„è¡£ç‰©ï¼Œå¾€é©åˆçš„æ–¹ä½ç™¼å±•ï¼Œé€éè¼¸å‡ºæ‰è¯(é£Ÿå‚·)æˆ–è¿½æ±‚äº‹æ¥­(å®˜æ®º)ä¾†æ¶ˆè€—éå‰©ç²¾åŠ›ã€‚`;
        } else {
            // èº«å¼±å–œ ç”Ÿã€æ‰¶ (åŒé»¨)
            adviceHtml += `<span class="tag tag-good">å–œï¼š${sameParty.join('ã€')}</span> (è²´äººé‹)<br>`;
            adviceHtml += `æ‚¨èƒ½é‡è¼ƒå¼±ï¼Œå®¹æ˜“ç–²æ†Šæˆ–å—ç’°å¢ƒå½±éŸ¿ã€‚<strong>å–œç”¨ç¥ç‚ºã€Œç”Ÿæ‰¶ã€</strong>ä¹‹äº”è¡Œã€‚<br>`;
            adviceHtml += `å»ºè­°å¤šèˆ‡å±¬${sameParty[1]}æˆ–${sameParty[0]}çš„äººè¦ªè¿‘ï¼Œé…æˆ´ç›¸æ‡‰é£¾å“ï¼Œå¢åŠ è‡ªä¿¡èˆ‡åº•æ°£ã€‚`;
        }
        document.getElementById('luckyAdvice').innerHTML = adviceHtml;
    }

    // å¥åº·é¢¨éšªæƒæ
    function analyzeHealth(scores) {
        let risks = [];
        const thresholdHigh = 35; // éæ—ºæ¨™æº–
        const thresholdLow = 8;   // éå¼±æ¨™æº–

        const healthMap = {
            'æœ¨': 'è‚è†½ã€ç¥ç¶“ç³»çµ±ã€ç­‹éª¨ã€å››è‚¢',
            'ç«': 'å¿ƒè¡€ç®¡ã€å°è…¸ã€çœ¼ç›ã€ç™¼ç‚å•é¡Œ',
            'åœŸ': 'è„¾èƒƒã€æ¶ˆåŒ–ç³»çµ±ã€è‚Œè‚‰ã€çš®è†š',
            'é‡‘': 'è‚ºéƒ¨ã€å‘¼å¸ç³»çµ±ã€å¤§è…¸ã€é¼»å­',
            'æ°´': 'è…è‡Ÿã€æ³Œå°¿ç³»çµ±ã€è¡€æ¶²ã€è€³éƒ¨'
        };

        for (let el in scores) {
            if (scores[el] > thresholdHigh) {
                risks.push(`<i class="fas fa-exclamation-triangle" style="color:#e74c3c;"></i> <strong>${el}æ°£éæ—ºï¼š</strong> æ³¨æ„ ${healthMap[el]} ä¿é¤Šã€‚`);
            }
            if (scores[el] < thresholdLow) {
                risks.push(`<i class="fas fa-arrow-down" style="color:#f39c12;"></i> <strong>${el}æ°£å¤ªå¼±ï¼š</strong> ç•™æ„ ${healthMap[el]} éš±æ†‚ã€‚`);
            }
        }

        if (risks.length === 0) {
            document.getElementById('healthRisks').innerHTML = '<span style="color:#2ecc71;"><i class="fas fa-check-circle"></i> äº”è¡Œæµé€šç›¸å°å¹³è¡¡ï¼Œè«‹ç¹¼çºŒä¿æŒè‰¯å¥½çš„ç”Ÿæ´»ä½œæ¯ã€‚</span>';
        } else {
            document.getElementById('healthRisks').innerHTML = risks.join('<br><br>');
        }
    }

    // å³æ™‚é‹å‹¢åˆ†æ
    function analyzeCurrentLuck(baZi) {
        const now = new Date();
        const curSolar = Solar.fromDate(now);
        const curLunar = curSolar.getLunar();
        const curBaZi = curLunar.getEightChar();

        // é¡¯ç¤ºæ™‚é–“
        document.getElementById('currentTimeStr').innerText = `æ›´æ–°æ–¼: ${now.getHours()}:${now.getMinutes() < 10 ? '0'+now.getMinutes() : now.getMinutes()}`;

        // é¡¯ç¤ºæµå¹´/æœˆ/æ—¥/æ™‚å¹²æ”¯
        document.getElementById('curYear').innerHTML = toTraditional(curBaZi.getYearGan()) + toTraditional(curBaZi.getYearZhi());
        document.getElementById('curMonth').innerHTML = toTraditional(curBaZi.getMonthGan()) + toTraditional(curBaZi.getMonthZhi());
        document.getElementById('curDay').innerHTML = toTraditional(curBaZi.getDayGan()) + toTraditional(curBaZi.getDayZhi());
        document.getElementById('curHour').innerHTML = toTraditional(curBaZi.getTimeGan()) + toTraditional(curBaZi.getTimeZhi());

        // ç°¡å–®é‚è¼¯ï¼šçœ‹æµæ—¥ vs æ—¥ä¸»
        const me = baZi.getDayGan(); // æœ¬å‘½æ—¥ä¸»
        const todayGan = curBaZi.getDayGan(); // æµæ—¥å¤©å¹²
        const todayZhi = curBaZi.getDayZhi(); // æµæ—¥åœ°æ”¯
        const myZhi = baZi.getDayZhi(); // æœ¬å‘½æ—¥æ”¯

        let advice = [];
        
        // 1. å¤©å¹²é—œä¿‚
        if (me === todayGan) advice.push("ä»Šæ—¥æ˜¯ã€Œæ¯”è‚©/åŠ«è²¡ã€æ—¥ï¼Œäººéš›äº’å‹•å¤šï¼Œé©åˆç¤¾äº¤ï¼Œä½†æ³¨æ„èŠ±è²»ã€‚");
        // ç°¡å–®åˆ¤æ–·å…‹æˆ‘ (å®˜æ®º)
        // é€™è£¡åƒ…åšç°¡å–®ç¤ºç¯„ï¼Œå®Œæ•´é‚è¼¯éœ€äº”è¡Œç”Ÿå‰‹è¡¨
        
        // 2. åœ°æ”¯è¡å‰‹ (é‡é»ï¼)
        // å…­æ²–ï¼šå­åˆ, ä¸‘æœª, å¯…ç”³, å¯é…‰, è¾°æˆŒ, å·³äº¥
        const chongMap = {'å­':'åˆ', 'åˆ':'å­', 'ä¸‘':'æœª', 'æœª':'ä¸‘', 'å¯…':'ç”³', 'ç”³':'å¯…', 'å¯':'é…‰', 'é…‰':'å¯', 'è¾°':'æˆŒ', 'æˆŒ':'è¾°', 'å·³':'äº¥', 'äº¥':'å·³'};
        
        if (chongMap[myZhi] === todayZhi) {
            advice.push(`<span style="color:#ff6b6b; font-weight:bold;">âš ï¸ ä»Šæ—¥åœ°æ”¯èˆ‡æ‚¨ã€Œç›¸æ²–ã€ï¼</span> è«¸äº‹ä¸å®œè¡å‹•ï¼Œå¤–å‡ºæ³¨æ„äº¤é€šï¼Œå®¹æ˜“å¿ƒç¥ä¸å¯§ã€‚`);
        } else if (todayZhi === myZhi) {
            advice.push(`ä»Šæ—¥æ˜¯æ‚¨çš„ã€Œä¼åŸã€æ—¥ï¼ˆæ—¥æ”¯ç›¸åŒï¼‰ï¼Œå¿ƒæƒ…å¯èƒ½è¼ƒç‚ºæ‚¶æ‚¶ä¸æ¨‚æˆ–åè¦†ï¼Œé©åˆéœæ…‹æ´»å‹•ã€‚`);
        } else {
            advice.push("ä»Šæ—¥åœ°æ”¯æ°£å ´å¹³ç©©ï¼ŒæŒ‰éƒ¨å°±ç­å³å¯ã€‚");
        }

        // 3. æµæ™‚å»ºè­°
        const curHourZhi = curBaZi.getTimeZhi();
        advice.push(`æ­¤åˆ»(${toTraditional(curHourZhi)}æ™‚)é‹å‹¢ï¼šè«‹ä¿æŒå¿ƒå¹³æ°£å’Œï¼Œé—œæ³¨ç•¶ä¸‹ã€‚`);

        document.getElementById('currentLuckAdvice').innerHTML = advice.join('<br>');
    }
</script>

</body>
</html>